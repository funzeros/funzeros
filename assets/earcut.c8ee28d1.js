var T={exports:{}};T.exports=L,T.exports.default=L;function L(e,t,n){n=n||2;var f=t&&t.length,r=f?t[0]*n:e.length,x=C(e,0,r,n,!0),u=[];if(!x||x.next===x.prev)return u;var i,o,y,c,s,p,v;if(f&&(x=K(e,t,x,n)),e.length>80*n){i=y=e[0],o=c=e[1];for(var l=n;l<r;l+=n)s=e[l],p=e[l+1],s<i&&(i=s),p<o&&(o=p),s>y&&(y=s),p>c&&(c=p);v=Math.max(y-i,c-o),v=v!==0?1/v:0}return g(x,u,n,i,o,v),u}function C(e,t,n,f,r){var x,u;if(r===P(e,t,n,f)>0)for(x=t;x<n;x+=f)u=D(x,e[x],e[x+1],u);else for(x=n-f;x>=t;x-=f)u=D(x,e[x],e[x+1],u);return u&&k(u,u.next)&&(M(u),u=u.next),u}function Z(e,t){if(!e)return e;t||(t=e);var n=e,f;do if(f=!1,!n.steiner&&(k(n,n.next)||h(n.prev,n,n.next)===0)){if(M(n),n=t=n.prev,n===n.next)break;f=!0}else n=n.next;while(f||n!==t);return t}function g(e,t,n,f,r,x,u){if(!!e){!u&&x&&_(e,f,r,x);for(var i=e,o,y;e.prev!==e.next;){if(o=e.prev,y=e.next,x?V(e,f,r,x):O(e)){t.push(o.i/n),t.push(e.i/n),t.push(y.i/n),M(e),e=y.next,i=y.next;continue}if(e=y,e===i){u?u===1?(e=G(Z(e),t,n),g(e,t,n,f,r,x,2)):u===2&&J(e,t,n,f,r,x):g(Z(e),t,n,f,r,x,1);break}}}}function O(e){var t=e.prev,n=e,f=e.next;if(h(t,n,f)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(w(t.x,t.y,n.x,n.y,f.x,f.y,r.x,r.y)&&h(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function V(e,t,n,f){var r=e.prev,x=e,u=e.next;if(h(r,x,u)>=0)return!1;for(var i=r.x<x.x?r.x<u.x?r.x:u.x:x.x<u.x?x.x:u.x,o=r.y<x.y?r.y<u.y?r.y:u.y:x.y<u.y?x.y:u.y,y=r.x>x.x?r.x>u.x?r.x:u.x:x.x>u.x?x.x:u.x,c=r.y>x.y?r.y>u.y?r.y:u.y:x.y>u.y?x.y:u.y,s=A(i,o,t,n,f),p=A(y,c,t,n,f),v=e.prevZ,l=e.nextZ;v&&v.z>=s&&l&&l.z<=p;){if(v!==e.prev&&v!==e.next&&w(r.x,r.y,x.x,x.y,u.x,u.y,v.x,v.y)&&h(v.prev,v,v.next)>=0||(v=v.prevZ,l!==e.prev&&l!==e.next&&w(r.x,r.y,x.x,x.y,u.x,u.y,l.x,l.y)&&h(l.prev,l,l.next)>=0))return!1;l=l.nextZ}for(;v&&v.z>=s;){if(v!==e.prev&&v!==e.next&&w(r.x,r.y,x.x,x.y,u.x,u.y,v.x,v.y)&&h(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;l&&l.z<=p;){if(l!==e.prev&&l!==e.next&&w(r.x,r.y,x.x,x.y,u.x,u.y,l.x,l.y)&&h(l.prev,l,l.next)>=0)return!1;l=l.nextZ}return!0}function G(e,t,n){var f=e;do{var r=f.prev,x=f.next.next;!k(r,x)&&$(r,f,f.next,x)&&F(r,x)&&F(x,r)&&(t.push(r.i/n),t.push(f.i/n),t.push(x.i/n),M(f),M(f.next),f=e=x),f=f.next}while(f!==e);return Z(f)}function J(e,t,n,f,r,x){var u=e;do{for(var i=u.next.next;i!==u.prev;){if(u.i!==i.i&&I(u,i)){var o=B(u,i);u=Z(u,u.next),o=Z(o,o.next),g(u,t,n,f,r,x),g(o,t,n,f,r,x);return}i=i.next}u=u.next}while(u!==e)}function K(e,t,n,f){var r=[],x,u,i,o,y;for(x=0,u=t.length;x<u;x++)i=t[x]*f,o=x<u-1?t[x+1]*f:e.length,y=C(e,i,o,f,!1),y===y.next&&(y.steiner=!0),r.push(Y(y));for(r.sort(Q),x=0;x<r.length;x++)R(r[x],n),n=Z(n,n.next);return n}function Q(e,t){return e.x-t.x}function R(e,t){if(t=U(e,t),t){var n=B(t,e);Z(t,t.next),Z(n,n.next)}}function U(e,t){var n=t,f=e.x,r=e.y,x=-1/0,u;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var i=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(i<=f&&i>x){if(x=i,i===f){if(r===n.y)return n;if(r===n.next.y)return n.next}u=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!u)return null;if(f===x)return u;var o=u,y=u.x,c=u.y,s=1/0,p;n=u;do f>=n.x&&n.x>=y&&f!==n.x&&w(r<c?f:x,r,y,c,r<c?x:f,r,n.x,n.y)&&(p=Math.abs(r-n.y)/(f-n.x),F(n,e)&&(p<s||p===s&&(n.x>u.x||n.x===u.x&&W(u,n)))&&(u=n,s=p)),n=n.next;while(n!==o);return u}function W(e,t){return h(e.prev,e,t.prev)<0&&h(t.next,e,e.next)<0}function _(e,t,n,f){var r=e;do r.z===null&&(r.z=A(r.x,r.y,t,n,f)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,X(r)}function X(e){var t,n,f,r,x,u,i,o,y=1;do{for(n=e,e=null,x=null,u=0;n;){for(u++,f=n,i=0,t=0;t<y&&(i++,f=f.nextZ,!!f);t++);for(o=y;i>0||o>0&&f;)i!==0&&(o===0||!f||n.z<=f.z)?(r=n,n=n.nextZ,i--):(r=f,f=f.nextZ,o--),x?x.nextZ=r:e=r,r.prevZ=x,x=r;n=f}x.nextZ=null,y*=2}while(u>1);return e}function A(e,t,n,f,r){return e=32767*(e-n)*r,t=32767*(t-f)*r,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Y(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function w(e,t,n,f,r,x,u,i){return(r-u)*(t-i)-(e-u)*(x-i)>=0&&(e-u)*(f-i)-(n-u)*(t-i)>=0&&(n-u)*(x-i)-(r-u)*(f-i)>=0}function I(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!S(e,t)&&(F(e,t)&&F(t,e)&&j(e,t)&&(h(e.prev,e,t.prev)||h(e,t.prev,t))||k(e,t)&&h(e.prev,e,e.next)>0&&h(t.prev,t,t.next)>0)}function h(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function k(e,t){return e.x===t.x&&e.y===t.y}function $(e,t,n,f){var r=z(h(e,t,n)),x=z(h(e,t,f)),u=z(h(n,f,e)),i=z(h(n,f,t));return!!(r!==x&&u!==i||r===0&&H(e,n,t)||x===0&&H(e,f,t)||u===0&&H(n,e,f)||i===0&&H(n,t,f))}function H(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function z(e){return e>0?1:e<0?-1:0}function S(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&$(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function F(e,t){return h(e.prev,e,e.next)<0?h(e,t,e.next)>=0&&h(e,e.prev,t)>=0:h(e,t,e.prev)<0||h(e,e.next,t)<0}function j(e,t){var n=e,f=!1,r=(e.x+t.x)/2,x=(e.y+t.y)/2;do n.y>x!=n.next.y>x&&n.next.y!==n.y&&r<(n.next.x-n.x)*(x-n.y)/(n.next.y-n.y)+n.x&&(f=!f),n=n.next;while(n!==e);return f}function B(e,t){var n=new E(e.i,e.x,e.y),f=new E(t.i,t.x,t.y),r=e.next,x=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,f.next=n,n.prev=f,x.next=f,f.prev=x,f}function D(e,t,n,f){var r=new E(e,t,n);return f?(r.next=f.next,r.prev=f,f.next.prev=r,f.next=r):(r.prev=r,r.next=r),r}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}L.deviation=function(e,t,n,f){var r=t&&t.length,x=r?t[0]*n:e.length,u=Math.abs(P(e,0,x,n));if(r)for(var i=0,o=t.length;i<o;i++){var y=t[i]*n,c=i<o-1?t[i+1]*n:e.length;u-=Math.abs(P(e,y,c,n))}var s=0;for(i=0;i<f.length;i+=3){var p=f[i]*n,v=f[i+1]*n,l=f[i+2]*n;s+=Math.abs((e[p]-e[l])*(e[v+1]-e[p+1])-(e[p]-e[v])*(e[l+1]-e[p+1]))}return u===0&&s===0?0:Math.abs((s-u)/u)};function P(e,t,n,f){for(var r=0,x=t,u=n-f;x<n;x+=f)r+=(e[u]-e[x])*(e[x+1]+e[u+1]),u=x;return r}L.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},f=0,r=0;r<e.length;r++){for(var x=0;x<e[r].length;x++)for(var u=0;u<t;u++)n.vertices.push(e[r][x][u]);r>0&&(f+=e[r-1].length,n.holes.push(f))}return n};var N=T.exports;export{N as e};
