import{D as S}from"./parse-uri.68f12d7d.js";import{M as l}from"./mini-signals.509d95ee.js";/*!
 * resource-loader - v3.0.1
 * https://github.com/pixijs/pixi-sound
 * Compiled Tue, 02 Jul 2019 14:06:18 UTC
 *
 * resource-loader is licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license
 */function _(){}function P(e,s,r,t){var i=0,n=e.length;(function a(h){if(h||i===n){r&&r(h);return}t?setTimeout(function(){s(e[i++],a)},1):s(e[i++],a)})()}function b(e){return function(){if(e===null)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,arguments)}}function w(e,s){if(s==null)s=1;else if(s===0)throw new Error("Concurrency must not be zero");var r=0,t={_tasks:[],concurrency:s,saturated:_,unsaturated:_,buffer:s/4,empty:_,drain:_,error:_,started:!1,paused:!1,push:function(h,u){i(h,!1,u)},kill:function(){r=0,t.drain=_,t.started=!1,t._tasks=[]},unshift:function(h,u){i(h,!0,u)},process:function(){for(;!t.paused&&r<t.concurrency&&t._tasks.length;){var h=t._tasks.shift();t._tasks.length===0&&t.empty(),r+=1,r===t.concurrency&&t.saturated(),e(h.data,b(n(h)))}},length:function(){return t._tasks.length},running:function(){return r},idle:function(){return t._tasks.length+r===0},pause:function(){t.paused!==!0&&(t.paused=!0)},resume:function(){if(t.paused!==!1){t.paused=!1;for(var h=1;h<=t.concurrency;h++)t.process()}}};function i(a,h,u){if(u!=null&&typeof u!="function")throw new Error("task callback must be a function");if(t.started=!0,a==null&&t.idle()){setTimeout(function(){return t.drain()},1);return}var d={data:a,callback:typeof u=="function"?u:_};h?t._tasks.unshift(d):t._tasks.push(d),setTimeout(function(){return t.process()},1)}function n(a){return function(){r-=1,a.callback.apply(a,arguments),arguments[0]!=null&&t.error(arguments[0],a.data),r<=t.concurrency-t.buffer&&t.unsaturated(),t.idle()&&t.drain(),t.process()}}return t}var g={};function X(e,s){var r=this;g[e.url]?(e.data=g[e.url],e.complete()):e.onComplete.once(function(){return g[r.url]=r.data}),s()}function A(e,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function v(e,s,r){return s&&A(e.prototype,s),r&&A(e,r),e}var M=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)),p=null,Y=0,L=200,N=204,D=1223,U=2;function C(){}var o=function(){e.setExtensionLoadType=function(t,i){R(e._loadTypeMap,t,i)},e.setExtensionXhrType=function(t,i){R(e._xhrTypeMap,t,i)};function e(r,t,i){if(typeof r!="string"||typeof t!="string")throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(e.STATUS_FLAGS.DATA_URL,t.indexOf("data:")===0),this.name=r,this.url=t,this.extension=this._getExtension(),this.data=null,this.crossOrigin=i.crossOrigin===!0?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=e.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=C,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new l,this.onProgress=new l,this.onComplete=new l,this.onAfterMiddleware=new l}var s=e.prototype;return s.complete=function(){this._clearEvents(),this._finish()},s.abort=function(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=e.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},s.load=function(t){var i=this;if(!this.isLoading){if(this.isComplete){t&&setTimeout(function(){return t(i)},1);return}else t&&this.onComplete.once(t);switch(this._setFlag(e.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case e.LOAD_TYPE.IMAGE:this.type=e.TYPE.IMAGE,this._loadElement("image");break;case e.LOAD_TYPE.AUDIO:this.type=e.TYPE.AUDIO,this._loadSourceElement("audio");break;case e.LOAD_TYPE.VIDEO:this.type=e.TYPE.VIDEO,this._loadSourceElement("video");break;case e.LOAD_TYPE.XHR:default:M&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},s._hasFlag=function(t){return(this._flags&t)!=0},s._setFlag=function(t,i){this._flags=i?this._flags|t:this._flags&~t},s._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},s._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(e.STATUS_FLAGS.COMPLETE,!0),this._setFlag(e.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},s._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:t==="image"&&typeof window.Image!="undefined"?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},s._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:t==="audio"&&typeof window.Audio!="undefined"?this.data=new Audio:this.data=document.createElement(t),this.data===null){this.abort("Unsupported element: "+t);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var i=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(i)?i[n]:i));else{var a=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(a)?a[0]:a))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},s._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===e.XHR_RESPONSE_TYPE.JSON||this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=e.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},s._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},s._createSource=function(t,i,n){n||(n=t+"/"+this._getExtension(i));var a=document.createElement("source");return a.src=i,a.type=n,a},s._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},s._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},s._onTimeout=function(){this.abort("Load timed out.")},s._xhrOnError=function(){var t=this.xhr;this.abort(O(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},s._xhrOnTimeout=function(){var t=this.xhr;this.abort(O(t)+" Request timed out.")},s._xhrOnAbort=function(){var t=this.xhr;this.abort(O(t)+" Request was aborted by the user.")},s._xhrOnLoad=function(){var t=this.xhr,i="",n=typeof t.status=="undefined"?L:t.status;(t.responseType===""||t.responseType==="text"||typeof t.responseType=="undefined")&&(i=t.responseText),n===Y&&(i.length>0||t.responseType===e.XHR_RESPONSE_TYPE.BUFFER)?n=L:n===D&&(n=N);var a=n/100|0;if(a===U)if(this.xhrType===e.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=e.TYPE.TEXT;else if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=e.TYPE.JSON}catch(d){this.abort("Error trying to parse loaded json: "+d);return}else if(this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var h=new DOMParser;this.data=h.parseFromString(i,"text/xml")}else{var u=document.createElement("div");u.innerHTML=i,this.data=u}this.type=e.TYPE.XML}catch(d){this.abort("Error trying to parse loaded xml: "+d);return}else this.data=t.response||i;else{this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL);return}this.complete()},s._determineCrossOrigin=function(t,i){if(t.indexOf("data:")===0)return"";if(window.origin!==window.location.origin)return"anonymous";i=i||window.location,p||(p=document.createElement("a")),p.href=t,t=S(p.href,{strictMode:!0});var n=!t.port&&i.port===""||t.port===i.port,a=t.protocol?t.protocol+":":"";return t.host!==i.hostname||!n||a!==i.protocol?"anonymous":""},s._determineXhrType=function(){return e._xhrTypeMap[this.extension]||e.XHR_RESPONSE_TYPE.TEXT},s._determineLoadType=function(){return e._loadTypeMap[this.extension]||e.LOAD_TYPE.XHR},s._getExtension=function(){var t=this.url,i="";if(this.isDataUrl){var n=t.indexOf("/");i=t.substring(n+1,t.indexOf(";",n))}else{var a=t.indexOf("?"),h=t.indexOf("#"),u=Math.min(a>-1?a:t.length,h>-1?h:t.length);t=t.substring(0,u),i=t.substring(t.lastIndexOf(".")+1)}return i.toLowerCase()},s._getMimeFromXhrType=function(t){switch(t){case e.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case e.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case e.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case e.XHR_RESPONSE_TYPE.JSON:return"application/json";case e.XHR_RESPONSE_TYPE.DEFAULT:case e.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},v(e,[{key:"isDataUrl",get:function(){return this._hasFlag(e.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(e.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(e.STATUS_FLAGS.LOADING)}}]),e}();o.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2},o.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},o.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},o.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},o._loadTypeMap={gif:o.LOAD_TYPE.IMAGE,png:o.LOAD_TYPE.IMAGE,bmp:o.LOAD_TYPE.IMAGE,jpg:o.LOAD_TYPE.IMAGE,jpeg:o.LOAD_TYPE.IMAGE,tif:o.LOAD_TYPE.IMAGE,tiff:o.LOAD_TYPE.IMAGE,webp:o.LOAD_TYPE.IMAGE,tga:o.LOAD_TYPE.IMAGE,svg:o.LOAD_TYPE.IMAGE,"svg+xml":o.LOAD_TYPE.IMAGE,mp3:o.LOAD_TYPE.AUDIO,ogg:o.LOAD_TYPE.AUDIO,wav:o.LOAD_TYPE.AUDIO,mp4:o.LOAD_TYPE.VIDEO,webm:o.LOAD_TYPE.VIDEO},o._xhrTypeMap={xhtml:o.XHR_RESPONSE_TYPE.DOCUMENT,html:o.XHR_RESPONSE_TYPE.DOCUMENT,htm:o.XHR_RESPONSE_TYPE.DOCUMENT,xml:o.XHR_RESPONSE_TYPE.DOCUMENT,tmx:o.XHR_RESPONSE_TYPE.DOCUMENT,svg:o.XHR_RESPONSE_TYPE.DOCUMENT,tsx:o.XHR_RESPONSE_TYPE.DOCUMENT,gif:o.XHR_RESPONSE_TYPE.BLOB,png:o.XHR_RESPONSE_TYPE.BLOB,bmp:o.XHR_RESPONSE_TYPE.BLOB,jpg:o.XHR_RESPONSE_TYPE.BLOB,jpeg:o.XHR_RESPONSE_TYPE.BLOB,tif:o.XHR_RESPONSE_TYPE.BLOB,tiff:o.XHR_RESPONSE_TYPE.BLOB,webp:o.XHR_RESPONSE_TYPE.BLOB,tga:o.XHR_RESPONSE_TYPE.BLOB,json:o.XHR_RESPONSE_TYPE.JSON,text:o.XHR_RESPONSE_TYPE.TEXT,txt:o.XHR_RESPONSE_TYPE.TEXT,ttf:o.XHR_RESPONSE_TYPE.BUFFER,otf:o.XHR_RESPONSE_TYPE.BUFFER},o.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function R(e,s,r){s&&s.indexOf(".")===0&&(s=s.substring(1)),!!s&&(e[s]=r)}function O(e){return e.toString().replace("object ","")}var H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function B(e){for(var s="",r=0;r<e.length;){for(var t=[0,0,0],i=[0,0,0,0],n=0;n<t.length;++n)r<e.length?t[n]=e.charCodeAt(r++)&255:t[n]=0;i[0]=t[0]>>2,i[1]=(t[0]&3)<<4|t[1]>>4,i[2]=(t[1]&15)<<2|t[2]>>6,i[3]=t[2]&63;var a=r-(e.length-1);switch(a){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64;break}for(var h=0;h<i.length;++h)s+=H.charAt(i[h])}return s}var y=window.URL||window.webkitURL;function k(e,s){if(!e.data){s();return}if(e.xhr&&e.xhrType===o.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof e.data=="string"){var r=e.xhr.getResponseHeader("content-type");if(r&&r.indexOf("image")===0){e.data=new Image,e.data.src="data:"+r+";base64,"+B(e.xhr.responseText),e.type=o.TYPE.IMAGE,e.data.onload=function(){e.data.onload=null,s()};return}}else if(e.data.type.indexOf("image")===0){var t=y.createObjectURL(e.data);e.blob=e.data,e.data=new Image,e.data.src=t,e.type=o.TYPE.IMAGE,e.data.onload=function(){y.revokeObjectURL(t),e.data.onload=null,s()};return}}s()}var F={caching:X,parsing:k},m=100,G=/(#[\w-]+)?$/,f=function(){function e(r,t){var i=this;r===void 0&&(r=""),t===void 0&&(t=10),this.baseUrl=r,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return i._loadResource(h,u)},this._queue=w(this._boundLoadResource,t),this._queue.pause(),this.resources={},this.onProgress=new l,this.onError=new l,this.onLoad=new l,this.onStart=new l,this.onComplete=new l;for(var n=0;n<e._defaultBeforeMiddleware.length;++n)this.pre(e._defaultBeforeMiddleware[n]);for(var a=0;a<e._defaultAfterMiddleware.length;++a)this.use(e._defaultAfterMiddleware[a])}var s=e.prototype;return s.add=function(t,i,n,a){if(Array.isArray(t)){for(var h=0;h<t.length;++h)this.add(t[h]);return this}if(typeof t=="object"&&(a=i||t.callback||t.onComplete,n=t,i=t.url,t=t.name||t.key||t.url),typeof i!="string"&&(a=n,n=i,i=t),typeof i!="string")throw new Error("No url passed to add resource to loader.");if(typeof n=="function"&&(a=n,n=null),this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(i=this._prepareUrl(i),this.resources[t]=new o(t,i,n),typeof a=="function"&&this.resources[t].onAfterMiddleware.once(a),this.loading){for(var u=n.parentResource,d=[],E=0;E<u.children.length;++E)u.children[E].isComplete||d.push(u.children[E]);var x=u.progressChunk*(d.length+1),T=x/(d.length+2);u.children.push(this.resources[t]),u.progressChunk=T;for(var c=0;c<d.length;++c)d[c].progressChunk=T;this.resources[t].progressChunk=T}return this._queue.push(this.resources[t]),this},s.pre=function(t){return this._beforeMiddleware.push(t),this},s.use=function(t){return this._afterMiddleware.push(t),this},s.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var t in this.resources){var i=this.resources[t];i._onLoadBinding&&i._onLoadBinding.detach(),i.isLoading&&i.abort()}return this.resources={},this},s.load=function(t){if(typeof t=="function"&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var i=this._queue._tasks.length,n=m/i,a=0;a<this._queue._tasks.length;++a)this._queue._tasks[a].data.progressChunk=n;this._onStart(),this._queue.resume()}return this},s._prepareUrl=function(t){var i=S(t,{strictMode:!0}),n;if(i.protocol||!i.path||t.indexOf("//")===0?n=t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&t.charAt(0)!=="/"?n=this.baseUrl+"/"+t:n=this.baseUrl+t,this.defaultQueryString){var a=G.exec(n)[0];n=n.substr(0,n.length-a.length),n.indexOf("?")!==-1?n+="&"+this.defaultQueryString:n+="?"+this.defaultQueryString,n+=a}return n},s._loadResource=function(t,i){var n=this;t._dequeue=i,P(this._beforeMiddleware,function(a,h){a.call(n,t,function(){h(t.isComplete?{}:null)})},function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())},!0)},s._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},s._onComplete=function(){this.progress=m,this.loading=!1,this.onComplete.dispatch(this,this.resources)},s._onLoad=function(t){var i=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),P(this._afterMiddleware,function(n,a){n.call(i,t,a)},function(){t.onAfterMiddleware.dispatch(t),i.progress=Math.min(m,i.progress+t.progressChunk),i.onProgress.dispatch(i,t),t.error?i.onError.dispatch(t.error,i,t):i.onLoad.dispatch(i,t),i._resourcesParsing.splice(i._resourcesParsing.indexOf(t),1),i._queue.idle()&&i._resourcesParsing.length===0&&i._onComplete()},!0)},v(e,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),e}();f._defaultBeforeMiddleware=[],f._defaultAfterMiddleware=[],f.pre=function(s){return f._defaultBeforeMiddleware.push(s),f},f.use=function(s){return f._defaultAfterMiddleware.push(s),f};export{f as L,o as R,F as i};
